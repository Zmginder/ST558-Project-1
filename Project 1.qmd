---
title: "Project 1"
author: "Zach Ginder and Makenna Meyer"
format: pdf
editor: visual
---

```{r, warnings=FALSE}
#Load in libraries
library(tidyverse)
```

# Data Reading

```{r}
#| message: false
census_2010<-read_csv("https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv")
```

# Data Processing

## Question 1: Column Selection

```{r}
#Select columns with area name, STCOU, and any column that ends in D
selected_columns<-census_2010|> 
  select(Area_name, STCOU, ends_with("D"))|>
  rename(area_name=Area_name)
head(selected_columns, n=5L)

```

## Question 2: Long Format Conversion

```{r}
#Convert the tibble into long format
long_format<- selected_columns|> 
  pivot_longer(cols = ends_with("D"), names_to = "surveys")
head(long_format,n=5L)

#Function that does question 1 and 2
long_conversion<-function(tibble, value="values for enrollment"){
  long_format<- tibble|>
    select(Area_name, STCOU, ends_with("D"))|>
    rename(area_name=Area_name)|>
    pivot_longer(cols = ends_with("D"), names_to = "surveys")
  return(long_format)
}
```

## Question 3: Create Year and Measurement Columns

```{r}
#Parse the Survey column to create measurement and year columns
long_updated<-long_format|>
  mutate(years=as.numeric(substr(surveys,8,9)))|>
  mutate(years=ifelse(years<=25 & years>=0,years+2000,years+1900))|>
  mutate(measurements=substr(surveys,1,7))
head(long_updated,n=5L)

#Function that does question 3
surveys_year_measurements<-function(long_format){
  long_updated<-long_format|>
  mutate(years=as.numeric(substr(surveys,8,9)))|>
  mutate(years=ifelse(years<=25 & years>=0,years+2000,years+1900))|>
  mutate(measurements=substr(surveys,1,7))
  return(long_updated)
}
```

## Step 4: Creating Two Data Sets

```{r}
#Without function
indices <- grep(pattern = ", \\w\\w", census_2010$Area_name)

county <- census_2010[indices,]
class(county) <- c("county", class(county))

non_county <- census_2010[-c(indices),]
class(non_county) <- c("state", class(non_county))
```

## Step 5: Creating State Variable for County Tibble

```{r}
#Without function
county_q5 <- county |>
  mutate(state = substr(Area_name, (nchar(Area_name) - 1), nchar(Area_name)))
```

```{r}
#With function

#Function to perform step 5
adding_state_to_county <- function(county_tibble){
  county_w_state <- county_tibble |>
    mutate(state = substr(Area_name, (nchar(Area_name) - 1), nchar(Area_name)))
  return(county_w_state)
}
```

## Step 6: Creating Division Variable for Non-County Tibble

```{r}
#Without function
non_county_q6 <- non_county |>
  mutate(division = 
           case_when(Area_name %in% c("CONNECTICUT", "MAINE", "MASSACHUSETTS", "NEW HAMPSHIRE",
                                      "RHODE ISLAND", "VERMONT") ~ "New England",
                     Area_name %in% c("NEW JERSEY", "NEW YORK", "PENNSYLVANIA") ~ "Mid-Atlantic",
                     Area_name %in% c("ILLINOIS", "INDIANA", "MICHIGAN", "OHIO", "WISCONSIN") 
                     ~ "East North Central",
                     Area_name %in% c("IOWA", "KANSAS", "MINNESOTA", "MISSOURI", "NEBRASKA", 
                                      "NORTH DAKOTA", "SOUTH DAKOTA") ~ "West North Central",
                     Area_name %in% c("DELAWARE", "District of Columbia", "DISTRICT OF COLUMBIA",
                                      "FLORIDA", "GEORGIA", "MARYLAND", "NORTH CAROLINA", 
                                      "SOUTH CAROLINA", "VIRGINIA", "WEST VIRGINIA") ~ "South Atlantic",
                     Area_name %in% c("KENTUCKY", "TENNESSEE", "MISSISSIPPI", "ALABAMA")
                     ~ "East South Central",
                     Area_name %in% c("ARKANSAS", "LOUISIANA", "OKLAHOMA", "TEXAS")
                     ~ "West South Central", 
                     Area_name %in% c("ARIZONA", "COLORADO", "IDAHO", "MONTANA", "NEVADA",
                                      "NEW MEXICO", "UTAH", "WYOMING") ~ "Mountain",
                     Area_name %in% c("ALASKA", "CALIFORNIA", "HAWAII", "OREGON", "WASHINGTON")
                     ~ "Pacific",
                     TRUE ~ "ERROR"))
```

```{r}
#With function

#Function to perform step 6
adding_division_to_noncounty <- function(noncounty_tibble){
  noncounty_w_division <- noncounty_tibble |>
    mutate(division = 
           case_when(Area_name %in% c("CONNECTICUT", "MAINE", "MASSACHUSETTS", "NEW HAMPSHIRE",
                                      "RHODE ISLAND", "VERMONT") ~ "New England",
                     Area_name %in% c("NEW JERSEY", "NEW YORK", "PENNSYLVANIA") ~ "Mid-Atlantic",
                     Area_name %in% c("ILLINOIS", "INDIANA", "MICHIGAN", "OHIO", "WISCONSIN") 
                     ~ "East North Central",
                     Area_name %in% c("IOWA", "KANSAS", "MINNESOTA", "MISSOURI", "NEBRASKA", 
                                      "NORTH DAKOTA", "SOUTH DAKOTA") ~ "West North Central",
                     Area_name %in% c("DELAWARE", "District of Columbia", "DISTRICT OF COLUMBIA",
                                      "FLORIDA", "GEORGIA", "MARYLAND", "NORTH CAROLINA", 
                                      "SOUTH CAROLINA", "VIRGINIA", "WEST VIRGINIA") ~ "South Atlantic",
                     Area_name %in% c("KENTUCKY", "TENNESSEE", "MISSISSIPPI", "ALABAMA")
                     ~ "East South Central",
                     Area_name %in% c("ARKANSAS", "LOUISIANA", "OKLAHOMA", "TEXAS")
                     ~ "West South Central", 
                     Area_name %in% c("ARIZONA", "COLORADO", "IDAHO", "MONTANA", "NEVADA",
                                      "NEW MEXICO", "UTAH", "WYOMING") ~ "Mountain",
                     Area_name %in% c("ALASKA", "CALIFORNIA", "HAWAII", "OREGON", "WASHINGTON")
                     ~ "Pacific",
                     TRUE ~ "ERROR"))
  return(noncounty_w_division)
}
```

```{r}
#Writing function that uses Step 3 output and performs Steps 4, 5, and 6

creating2tibbles_addingstateordivision <- function(long_updated){
  indices <- grep(pattern = ", \\w\\w", long_updated$Area_name)
  county_tibble <- long_updated[indices,]
  class(county_tibble) <- c("county", class(county_tibble))
  
  noncounty_tibble <- long_updated[-c(indices),]
  class(noncounty_tibble) <- c("state", class(noncounty_tibble))
  
  county_state_final <- adding_state_to_county(county_tibble)
  noncounty_division_final <- adding_division_to_noncounty(noncounty_tibble)
  
  return(county_state_final)
  return(noncounty_division_final)
}
```
