---
title: "Project 1"
author: "Zach Ginder and Makenna Meyer"
format: pdf
editor: visual
editor_options: 
  chunk_output_type: inline
---

```{r, warnings=FALSE}
rm(list=ls())

#Load in libraries
library(tidyverse)
```

## Data Reading

```{r}
census_2010 <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv")

sectiontwo <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv")

testdata_a <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/PST01a.csv")

testdata_b <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/PST01b.csv")

testdata_c <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/PST01c.csv")

testdata_d <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/PST01d.csv")
```

## Data Processing

## Step 1: Column Selection

```{r}
#Without function
census_2010_q1 <- census_2010 |>
  select(Area_name, STCOU, ends_with("D")) |>
  rename("area_name" = "Area_name")

head(census_2010_q1, n=5)
```

## Step 2: Long Format Conversion

```{r}
#Without function
census_2010_q2 <- census_2010_q1 |>
  pivot_longer(cols = c(ends_with("D")),
               names_to = "SurveyYear",
               values_to = "Enrollment")

head(census_2010_q2, n=5)
```

```{r}
#With function

#Function that does question 1 and 2
long_conversion <- function(tibble, value="values for enrollment"){
  long_format <- tibble |>
    select(Area_name, STCOU, ends_with("D"))|>
    rename(area_name = Area_name)|>
    pivot_longer(cols = ends_with("D"), names_to = "surveys")
  return(long_format)
}

#Testing 
long_format <- long_conversion(census_2010)
head(long_format, n=5)
```

## Step 3: Adding Variables for Survey, Year, and Measurement

```{r}
#Without function
long_updated <- census_2010_q2 |>
  mutate(Survey = substr(SurveyYear, 1, 3)) |>
  mutate(Measurement = substr(SurveyYear, 1, 7)) |>
  mutate(year_short = as.numeric(substr(SurveyYear, 8, 9))) |>
  mutate(Year = ifelse(year_short <= 25, year_short + 2000, year_short + 1900))
```

```{r}
#With function

#Function that does question 3
surveys_year_measurements <- function(long_format){
  long_updated <- long_format |>
  mutate(years = as.numeric(substr(surveys,8,9))) |>
  mutate(years = ifelse(years <= 25 & years >= 0, years + 2000, years + 1900)) |>
  mutate(measurements = substr(surveys, 1, 7))
  return(long_updated)
}

#Testing
long_updated <- surveys_year_measurements(long_format)
head(long_updated, n=5)
```

## Step 4: Creating Two Data Sets

```{r}
#Without function
indices <- grep(pattern = ", \\w\\w", long_updated$area_name)

county_tibble <- long_updated[indices,]
class(county_tibble) <- c("county", class(county_tibble))

state_tibble <- long_updated[-c(indices),]
class(state_tibble) <- c("state", class(state_tibble))

head(county_tibble, n=10)

head(state_tibble, n=10)
```

## Step 5: Creating State Variable for County Tibble

```{r}
#Without function
county_q5 <- county_tibble |>
  mutate(state = substr(area_name, (nchar(area_name) - 1), nchar(area_name)))
```

```{r}
#With function

#Function to perform step 5
adding_state_to_county <- function(county_tibble){
  county_w_state <- county_tibble |>
    mutate(state = substr(area_name, (nchar(area_name) - 1), nchar(area_name)))
  return(county_w_state)
}

#Testing 
county_q5_func <- adding_state_to_county(county_tibble)
```

## Step 6: Creating Division Variable for Non-County Tibble

```{r}
#Without function
non_county_q6 <- state_tibble |>
  mutate(division = 
           case_when(area_name %in% c("CONNECTICUT", "MAINE", "MASSACHUSETTS", "NEW HAMPSHIRE",
                                      "RHODE ISLAND", "VERMONT") ~ "New England",
                     area_name %in% c("NEW JERSEY", "NEW YORK", "PENNSYLVANIA") ~ "Mid-Atlantic",
                     area_name %in% c("ILLINOIS", "INDIANA", "MICHIGAN", "OHIO", "WISCONSIN") 
                     ~ "East North Central",
                     area_name %in% c("IOWA", "KANSAS", "MINNESOTA", "MISSOURI", "NEBRASKA", 
                                      "NORTH DAKOTA", "SOUTH DAKOTA") ~ "West North Central",
                     area_name %in% c("DELAWARE", "District of Columbia", "DISTRICT OF COLUMBIA",
                                      "FLORIDA", "GEORGIA", "MARYLAND", "NORTH CAROLINA", 
                                      "SOUTH CAROLINA", "VIRGINIA", "WEST VIRGINIA") ~ "South Atlantic",
                     area_name %in% c("KENTUCKY", "TENNESSEE", "MISSISSIPPI", "ALABAMA")
                     ~ "East South Central",
                     area_name %in% c("ARKANSAS", "LOUISIANA", "OKLAHOMA", "TEXAS")
                     ~ "West South Central", 
                     area_name %in% c("ARIZONA", "COLORADO", "IDAHO", "MONTANA", "NEVADA",
                                      "NEW MEXICO", "UTAH", "WYOMING") ~ "Mountain",
                     area_name %in% c("ALASKA", "CALIFORNIA", "HAWAII", "OREGON", "WASHINGTON")
                     ~ "Pacific",
                     TRUE ~ "ERROR"))
```

```{r}
#With function

#Function to perform step 6
adding_division_to_noncounty <- function(state_tibble){
  noncounty_w_division <- state_tibble |>
    mutate(division = 
           case_when(area_name %in% c("CONNECTICUT", "MAINE", "MASSACHUSETTS", "NEW HAMPSHIRE",
                                      "RHODE ISLAND", "VERMONT") ~ "New England",
                     area_name %in% c("NEW JERSEY", "NEW YORK", "PENNSYLVANIA") ~ "Mid-Atlantic",
                     area_name %in% c("ILLINOIS", "INDIANA", "MICHIGAN", "OHIO", "WISCONSIN") 
                     ~ "East North Central",
                     area_name %in% c("IOWA", "KANSAS", "MINNESOTA", "MISSOURI", "NEBRASKA", 
                                      "NORTH DAKOTA", "SOUTH DAKOTA") ~ "West North Central",
                     area_name %in% c("DELAWARE", "District of Columbia", "DISTRICT OF COLUMBIA",
                                      "FLORIDA", "GEORGIA", "MARYLAND", "NORTH CAROLINA", 
                                      "SOUTH CAROLINA", "VIRGINIA", "WEST VIRGINIA") ~ "South Atlantic",
                     area_name %in% c("KENTUCKY", "TENNESSEE", "MISSISSIPPI", "ALABAMA")
                     ~ "East South Central",
                     area_name %in% c("ARKANSAS", "LOUISIANA", "OKLAHOMA", "TEXAS")
                     ~ "West South Central", 
                     area_name %in% c("ARIZONA", "COLORADO", "IDAHO", "MONTANA", "NEVADA",
                                      "NEW MEXICO", "UTAH", "WYOMING") ~ "Mountain",
                     area_name %in% c("ALASKA", "CALIFORNIA", "HAWAII", "OREGON", "WASHINGTON")
                     ~ "Pacific",
                     TRUE ~ "ERROR"))
  return(noncounty_w_division)
}

#Testing 
noncounty_q6_func <- adding_division_to_noncounty(state_tibble)
```

```{r}
#Writing function that uses Step 3 output and performs Steps 4, 5, and 6

creating2tibbles_addingstateordivision <- function(long_updated){
  indices <- grep(pattern = ", \\w\\w", long_updated$area_name)
  county_tibble <- long_updated[indices,]
  class(county_tibble) <- c("county", class(county_tibble))
  
  state_tibble <- long_updated[-c(indices),]
  class(state_tibble) <- c("state", class(state_tibble))
  
  county_state_final <- adding_state_to_county(county_tibble)
  noncounty_division_final <- adding_division_to_noncounty(state_tibble)
  
  return(list("county_final" = county_state_final, "noncounty_final" = noncounty_division_final))
}

#Testing function for 456
final_datasets <- creating2tibbles_addingstateordivision(long_updated)
```

## Creating Wrapper Function

```{r}
wrapper_function <- function(url, value = "values for enrollment"){
  tibbles <- read_csv(url)|>
    long_conversion(value = value)|>
    surveys_year_measurements()|>
    creating2tibbles_addingstateordivision()
  return(tibbles)
}

```

```{r}
#Test wrapper function on two data sets
result1 <- wrapper_function(url="https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv", value = value)

result2 <- wrapper_function(url="https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv", value = value)
```

## Create Function to Combine Tibbles From Wrapper Iterations

```{r}
#Test wrapper function on two data sets and combine them
combine_tibbles <- function(tibble1,tibble2){
  county_combined_tibble<-tibble(bind_rows(as.data.frame(tibble1["county_final"]),
                                           as.data.frame(tibble2["county_final"])))
  state_combined_tibble<-tibble(bind_rows(as.data.frame(tibble1["noncounty_final"]),
                                          as.data.frame(tibble2["noncounty_final"])))
  return(list("county_combined" = county_combined_tibble, 
              "state_combined" = state_combined_tibble))
}

tibble1 <- wrapper_function(url="https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv",
                          value=value)
tibble2 <- wrapper_function(url="https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv",
                          value=value)

```

## Generic Function for Summarizing

```{r}
#Run these in your console
plot.function #what is used for a class = function
```

```{r}
getS3method("plot","data.frame") #what is used for a class = data frame
```

```{r}
plot
```

```{r}
plot.state <- function(df, var_name = "_your_default_value_"){
#code to find the means for each division and year (think tidyverse)
#Use get(var_name) to reference the var_name in your call to mean(): mean(get(var_name))
#For this, think group_by along with summarize
#remove the "ERROR" setting
#create a line plot with ggplot with appropriate aes() assignments
}
```

```{r}
plot(_class_state_df_here_, var_name = ...).
```
